<!DOCTYPE html>
<title>Hat</title>

<style>
    body {
        margin: 0;
    }

    svg {
        transform: scaleY(-1);
    }

    polygon {
        fill: #9999ff;
        stroke-width: 0.1;
    }
</style>

<div id="app">
    <div>
        <svg :view-box.camel="svgViewBox" :width="width" :height="height">
            <g v-for="hat in hats">
                <polygon :points="getPolylinePoints(hat)" fill="white" stroke="black" />
            </g>
        </svg>
    </div>
    <div>
        Scale: {{ scale }}
    </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
    const { createApp } = Vue

    const hat = [
        [0, -1],
        [1, -1],
        [1, 0],
        [0, 1],
        [1, 2],
        [2, 1],
        [3, -1],
        [4, -1],
    ];

    const hatOutline = [
        [0, 0],
        [-1, -1],
        [0, -2],
        [2, -2],
        [2, -1],
        [4, -2],
        [5, -1],
        [4, 0],
        [3, 0],
        [2, 2],
        [0, 3],
        [0, 2],
        [-1, 2],
    ];

    const rotM = [
        [1, 0, 0, 1],
        [0, -1, 1, 1],
        [-1, -1, 1, 0],
        [-1, 0, 0, -1],
        [0, 1, -1, -1],
        [1, 1, -1, 0],
    ];

    createApp({
        data() {
            return {
                width: window.innerWidth,
                height: window.innerHeight,
                cx: 0,
                cy: 0,
                scale: 20,
                hats: [],
            }
        },
        computed: {
            svgViewBox() {
                const x = (this.cx - this.width / 2) / this.scale;
                const y = (this.cy - this.height / 2) / this.scale;
                const w = this.width / this.scale;
                const h = this.height / this.scale;
                return `${x} ${y} ${w} ${h}`
            }
        },
        methods: {
            resize() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
            },
            getPolylinePoints(hat) {
                let res = "";
                for (let p of hatOutline) {
                    const r = ((hat.r % 6) + 6) % 6;
                    const rot = rotM[r];

                    const x = rot[0] * p[0] + rot[1] * p[1];
                    const y = rot[2] * p[0] + rot[3] * p[1];

                    const xx = x + hat.x;
                    const yy = y + hat.y;

                    const theta = Math.PI / 3;
                    const xxx = xx + yy * Math.cos(theta);
                    const yyy = yy * Math.sin(theta)

                    res += `${xxx} ${yyy} `
                }
                return res;
            },
        },
        mounted() {
            this.resize();
            window.addEventListener('resize', this.resize);

            this.hats.push({ x: 0, y: -4, r: -7 });
            this.hats.push({ x: 0, y: 0, r: 0 });
            this.hats.push({ x: 0, y: 4, r: 1 });
            this.hats.push({ x: 0, y: 8, r: 2 });
        },
    }).mount('#app')
</script>